<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Teacher Dashboard - Lingro Academy</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #1540A6 0%, #3C6EFA 60%, #D4AF37 100%);
            font-family: 'Inter', sans-serif;
            color: #ffffff;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        .card-modern, .lesson-card {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .lesson-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .navbar {
            background-color: rgba(0,0,0,0.4);
        }

        .modal-header {
            background: linear-gradient(90deg, #1540A6, #3C6EFA);
            color: #F2D27D;
        }

        h2, h3 {
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }

        video {
            width: 100%;
            border-radius: 15px;
            margin-top: 10px;
        }
    </style>
</head>
<body class="d-flex flex-column min-vh-100">

<nav class="navbar navbar-dark px-4 d-flex align-items-center">
    <img src="images/LingroAcademyLogo1.png" alt="Lingro Academy Logo" style="height:50px; margin-right:15px;">
    <span class="navbar-brand">Lingro Academy - Teacher Dashboard</span>
    <button class="btn btn-light ms-auto" onclick="logout()">Logout</button>
</nav>

<div class="container text-center mt-5">

    <h2 class="mb-4">Teaching Tools</h2>
    <a href="#" class="btn btn-primary btn-lg mb-5" onclick="startCall()">Start Lesson & Video Call</a>

    <h3 class="mb-4">Lesson Materials</h3>
    <div class="row justify-content-center g-4">

        <div class="col-md-3">
            <div class="card lesson-card p-3" onclick="previewLesson('lessons/lesson1.html')">
                <h5>Lesson 1</h5>
                <p>Basic English</p>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card lesson-card p-3" onclick="previewLesson('lessons/lesson2.html')">
                <h5>Lesson 2</h5>
                <p>Grammar Training</p>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card lesson-card p-3" onclick="previewLesson('lessons/lesson3.html')">
                <h5>Lesson 3</h5>
                <p>Vocabulary</p>
            </div>
        </div>

    </div>

    <!-- Video screens -->
    <div class="row mt-5 text-center">
        <div class="col-md-4">
            <h4>Teacher Camera</h4>
            <video id="teacherVideo" autoplay muted playsinline></video>
            <div class="mt-2">
                <button class="btn btn-warning" id="muteBtn">Mute</button>
                <button class="btn btn-danger" id="endCallBtn">End Call</button>
            </div>
        </div>
        <div class="col-md-4">
            <h4>Student Camera</h4>
            <video id="studentVideo" autoplay playsinline></video>
        </div>
        <div class="col-md-4">
            <h4>Shared Lesson</h4>
            <video id="lessonVideo" autoplay playsinline></video>
        </div>
    </div>
</div>

<!-- Preview Modal -->
<div class="modal fade" id="lessonModal" tabindex="-1" aria-labelledby="lessonModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="lessonModalLabel">Lesson Preview</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <iframe id="previewIframe" style="width:100%; height:400px; border:none;"></iframe>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-success" onclick="shareLesson()">Share Lesson</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Lesson preview
    function previewLesson(url) {
        document.getElementById("previewIframe").src = url;
        localStorage.setItem("lessonToShare", url);
        const modal = new bootstrap.Modal(document.getElementById('lessonModal'));
        modal.show();
    }

    // Share lesson
    function shareLesson() {
        const lesson = localStorage.getItem("lessonToShare");
        if (!lesson) return alert("No lesson selected");
        localStorage.setItem("lessonToOpen", lesson);
        alert("Lesson shared! Students can now see it.");
        const modalElement = document.getElementById('lessonModal');
        const modal = bootstrap.Modal.getInstance(modalElement);
        modal.hide();
    }

    function logout() {
        alert("Logging out...");
        window.location.href = "index.html";
    }

    // WebRTC video call
    let localStream, peerConnection;
    const config = { iceServers: [{ urls: "stun:stun.l.google.com:19302" }] };
    const studentVideo = document.getElementById("studentVideo");
    const teacherVideo = document.getElementById("teacherVideo");
    const muteBtn = document.getElementById("muteBtn");
    const endCallBtn = document.getElementById("endCallBtn");

    async function startCall() {
        localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
        teacherVideo.srcObject = localStream;

        peerConnection = new RTCPeerConnection(config);
        localStream.getTracks().forEach(track => peerConnection.addTrack(track, localStream));

        peerConnection.ontrack = e => {
            studentVideo.srcObject = e.streams[0];
        };

        peerConnection.onicecandidate = e => {
            if(e.candidate) localStorage.setItem("iceCandidate", JSON.stringify(e.candidate));
        };

        const offer = await peerConnection.createOffer();
        await peerConnection.setLocalDescription(offer);
        localStorage.setItem("offer", JSON.stringify(offer));
        alert("Offer created. Students join and check localStorage offer for demo.");
    }

    // Mute/unmute
    muteBtn.onclick = () => {
        localStream.getAudioTracks()[0].enabled = !localStream.getAudioTracks()[0].enabled;
        muteBtn.innerText = localStream.getAudioTracks()[0].enabled ? "Mute" : "Unmute";
    };

    // End call
    endCallBtn.onclick = () => {
        if(localStream) {
            localStream.getTracks().forEach(track => track.stop());
        }
        if(peerConnection) {
            peerConnection.close();
            peerConnection = null;
        }
        teacherVideo.srcObject = null;
        studentVideo.srcObject = null;
        alert("Call ended.");
    };
</script>

</body>
</html>
