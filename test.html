<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Teacher Dashboard - Lingro Academy</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body{background:linear-gradient(135deg,#1540A6,#3C6EFA,#D4AF37);color:#fff}
video,iframe{width:100%;border-radius:15px}
.lesson-card{background:rgba(255,255,255,0.15);cursor:pointer}
</style>
</head>
<body>

<div class="container mt-4 text-center">
<h2>Teacher Dashboard</h2>

<h5>Students</h5>
<div id="students"></div>

<button class="btn btn-primary my-3" onclick="startCall()">Start Call</button>

<div class="row mt-4">
<div class="col-md-4">
<h5>Teacher</h5>
<video id="teacherVideo" autoplay muted></video>
</div>
<div class="col-md-4">
<h5>Student</h5>
<video id="studentVideo" autoplay></video>
</div>
<div class="col-md-4">
<h5>Lesson</h5>
<iframe id="lessonFrame"></iframe>
</div>
</div>

<h4 class="mt-4">Lessons</h4>
<div class="row">
<div class="col-md-3 lesson-card p-3" onclick="shareLesson('lessons/lesson1.html')">Lesson 1</div>
<div class="col-md-3 lesson-card p-3" onclick="shareLesson('lessons/lesson2.html')">Lesson 2</div>
<div class="col-md-3 lesson-card p-3" onclick="shareLesson('lessons/lesson3.html')">Lesson 3</div>
</div>
</div>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
const socket = io("http://localhost:3000");
socket.emit("register-teacher");

let selectedStudent = null;
let pc, stream;

socket.on("student-list", list => {
    const div = document.getElementById("students");
    div.innerHTML = "";
    list.forEach(id => {
        const btn = document.createElement("button");
        btn.className = "btn btn-info m-1";
        btn.innerText = id.slice(0,5);
        btn.onclick = () => selectedStudent = id;
        div.appendChild(btn);
    });
});

async function startCall(){
    stream = await navigator.mediaDevices.getUserMedia({video:true,audio:true});
    teacherVideo.srcObject = stream;

    pc = new RTCPeerConnection();
    stream.getTracks().forEach(t => pc.addTrack(t, stream));
    pc.ontrack = e => studentVideo.srcObject = e.streams[0];
    pc.onicecandidate = e => e.candidate && socket.emit("ice-candidate", e.candidate);

    socket.emit("call-student", selectedStudent);

    const offer = await pc.createOffer();
    await pc.setLocalDescription(offer);
    socket.emit("offer", offer);
}

socket.on("answer", a => pc.setRemoteDescription(a));
socket.on("ice-candidate", c => pc.addIceCandidate(c));

function shareLesson(url){
    lessonFrame.src = url;
    socket.emit("share-lesson", url);
}
</script>
</body>
</html>
