<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Student Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body{background:linear-gradient(135deg,#1540A6,#3C6EFA,#D4AF37);color:#fff}
video,iframe{width:100%;border-radius:15px}
#popup{position:fixed;top:20px;right:20px;background:#1540A6;padding:20px;display:none}
</style>
</head>
<body>

<div class="container mt-4 text-center">
<h2>Student Dashboard</h2>

<div id="popup">
<p>Incoming Call</p>
<button class="btn btn-success" onclick="answer()">Answer</button>
</div>

<div class="row mt-4">
<div class="col-md-4">
<h5>Student</h5>
<video id="studentVideo" autoplay muted></video>
</div>
<div class="col-md-4">
<h5>Teacher</h5>
<video id="teacherVideo" autoplay></video>
</div>
<div class="col-md-4">
<h5>Lesson</h5>
<iframe id="lessonFrame"></iframe>
</div>
</div>
</div>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
const socket = io("http://localhost:3000");
socket.emit("register-student");

let pc, stream;

socket.on("incoming-call", () => {
    document.getElementById("popup").style.display = "block";
});

async function answer(){
    document.getElementById("popup").style.display = "none";

    stream = await navigator.mediaDevices.getUserMedia({video:true,audio:true});
    studentVideo.srcObject = stream;

    pc = new RTCPeerConnection();
    stream.getTracks().forEach(t => pc.addTrack(t, stream));
    pc.ontrack = e => teacherVideo.srcObject = e.streams[0];
    pc.onicecandidate = e => e.candidate && socket.emit("ice-candidate", e.candidate);
}

socket.on("offer", async offer => {
    await pc.setRemoteDescription(offer);
    const answer = await pc.createAnswer();
    await pc.setLocalDescription(answer);
    socket.emit("answer", answer);
});

socket.on("ice-candidate", c => pc.addIceCandidate(c));
socket.on("share-lesson", l => lessonFrame.src = l);
</script>
</body>
</html>
