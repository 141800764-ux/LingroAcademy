<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Dashboard - Lingro Academy</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: linear-gradient(135deg, #1540A6 0%, #3C6EFA 60%, #D4AF37 100%); font-family: 'Inter', sans-serif; color: #fff; min-height:100vh; }
        .lesson-card { background: rgba(255,255,255,0.15); cursor: pointer; transition: transform 0.2s; }
        .lesson-card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.3); }
        .navbar { background-color: rgba(0,0,0,0.4); }
        h2,h3 { text-shadow: 1px 1px 3px rgba(0,0,0,0.5); }
        video { width: 100%; border-radius: 15px; margin-top:10px; }
    </style>
</head>
<body>

<nav class="navbar navbar-dark px-4">
        <img src="images/LingroAcademyLogo1.png" alt="Lingro Academy Logo" style="height:50px; margin-right:15px;">

    <span class="navbar-brand">Lingro Academy - Student Dashboard</span>
    <button class="btn btn-light" onclick="logout()">Logout</button>
</nav>

<div class="container text-center mt-5">
    <h2 class="mb-4">Welcome, <span id="studentName"></span></h2>

    <h3 class="mb-4">Available Lessons</h3>
    <div class="row justify-content-center g-4">
        <div class="col-md-3">
            <div class="card lesson-card p-3" onclick="openLesson('lessons/lesson1.html')">
                <h5>Lesson 1</h5><p>Basic English</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card lesson-card p-3" onclick="openLesson('lessons/lesson2.html')">
                <h5>Lesson 2</h5><p>Grammar Training</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card lesson-card p-3" onclick="openLesson('lessons/lesson3.html')">
                <h5>Lesson 3</h5><p>Vocabulary</p>
            </div>
        </div>
    </div>

    <!-- Video screens -->
    <div class="row mt-5">
        <div class="col-md-6 text-center">
            <h4>Student Camera</h4>
            <video id="studentVideo" autoplay muted playsinline></video>
            <button class="btn btn-warning mt-2" id="muteBtn">Mute</button>
        </div>
        <div class="col-md-6 text-center">
            <h4>Teacher Camera</h4>
            <video id="teacherVideo" autoplay playsinline></video>
        </div>
    </div>
</div>

<script>
const student = JSON.parse(localStorage.getItem("loggedInStudent"));
if(student) document.getElementById("studentName").innerText = student.name;

function openLesson(url) {
    localStorage.setItem("lessonToOpen", url);
    window.location.href = "lesson.html";
}

function logout() {
    localStorage.removeItem("loggedInStudent");
    window.location.href = "index.html";
}

// WebRTC
let localStream, peerConnection;
const config = { iceServers: [{ urls: "stun:stun.l.google.com:19302" }] };
const teacherVideo = document.getElementById("teacherVideo");
const studentVideo = document.getElementById("studentVideo");
const muteBtn = document.getElementById("muteBtn");

async function joinCall() {
    localStream = await navigator.mediaDevices.getUserMedia({ video:true,audio:true });
    studentVideo.srcObject = localStream;

    peerConnection = new RTCPeerConnection(config);
    localStream.getTracks().forEach(track => peerConnection.addTrack(track, localStream));

    peerConnection.ontrack = e => { teacherVideo.srcObject = e.streams[0]; };
    peerConnection.onicecandidate = e => { if(e.candidate) localStorage.setItem("studentIce", JSON.stringify(e.candidate)); };

    const offer = JSON.parse(localStorage.getItem("offer"));
    if(!offer) return;
    await peerConnection.setRemoteDescription(offer);

    const answer = await peerConnection.createAnswer();
    await peerConnection.setLocalDescription(answer);
    localStorage.setItem("answer", JSON.stringify(answer));
}

muteBtn.onclick = () => {
    localStream.getAudioTracks()[0].enabled = !localStream.getAudioTracks()[0].enabled;
    muteBtn.innerText = localStream.getAudioTracks()[0].enabled ? "Mute":"Unmute";
};

joinCall();
</script>

</body>
</html>
